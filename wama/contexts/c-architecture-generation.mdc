# Architecture Generation Context

## Purpose
Enhanced context for VISHKAR architecture generation system. This context is loaded when the AI needs to generate comprehensive architecture documentation with diagrams, technical specifications, and deployment strategies.

## When to Load
- User requests architecture generation for a project
- LangGraph discussion reaches consensus and architecture extraction is triggered
- API endpoint `/api/langgraph/discussion/extract/architecture/{discussion_id}` is called
- User asks for architecture diagrams, deployment plans, or technical specifications

## Agent/Persona
The VISHKAR Architect persona (Morgan) is the primary agent for architecture generation.

Location: `~/.wama/agents/a-vishkar-architect.md`

This comprehensive persona file includes:
- Role and mission definition
- Core expertise (system design, cloud, database, security, scalability, DevOps)
- Responsibilities (analyze, design, diagram, document, deploy, IaC)
- Personality traits (strategic, detail-oriented, security-conscious, performance-focused, pragmatic)
- All 7 artifact templates with complete examples embedded
- Generation guidelines and quality standards
- Integration instructions for VISHKAR

## Artifacts Generated

The architecture generation system produces 7 comprehensive artifacts:

### 1. Architecture Summary (Markdown)
- Executive Summary
- System Overview
- Key Architectural Decisions
- Technology Stack Rationale
- Scalability Strategy
- Security Approach
- Performance Characteristics
- Deployment Strategy
- Monitoring and Operations
- Future Considerations

### 2. System Architecture Diagram (Mermaid)
- High-level system components
- Client, API, Business Logic, Data layers
- External service integrations
- Authentication/authorization boundaries
- Network topology

### 3. Component Diagram (Mermaid)
- Detailed module breakdown
- Frontend and backend components
- Dependencies and interfaces
- Shared libraries
- Service relationships

### 4. Flow Diagrams (Mermaid Sequence)
- 3-5 main user/data flows
- Authentication flow
- Core feature workflows
- Error handling flows
- Async process flows

### 5. Database Schema (Mermaid ER)
- Entity-Relationship diagram
- All tables with fields
- Relationships (1:1, 1:N, M:N)
- Primary keys, foreign keys, unique keys
- Indexes for performance
- Migration notes

### 6. Deployment Architecture (Mermaid)
- Cloud provider topology (AWS/Azure/GCP)
- Edge layer (CDN, DNS)
- Application layer (LB, containers, auto-scaling)
- Data layer (database, cache, storage)
- Monitoring and security components
- Multi-AZ configuration

### 7. Infrastructure as Code Plan (Markdown)
- IaC tool recommendation (Terraform/CloudFormation/Pulumi)
- Directory structure
- Module organization
- Environment configurations (dev/staging/prod)
- Sample code snippets
- Deployment procedures
- CI/CD integration
- Cost estimation

## Input Data

### From Discussion Consensus (LangGraph)
- Full discussion transcript from Alex, Blake, and Casey
- Agreed-upon requirements and features
- User personas and use cases
- Technology preferences mentioned
- Scale expectations (users, concurrent connections, data volume)
- Budget constraints
- Timeline requirements
- Compliance/regulatory requirements

### From VISHKAR Project Metadata
- Project name and description
- Organization and business unit
- Existing infrastructure constraints
- Team size and expertise
- Technology stack constraints
- Regulatory environment

### From User Input (Optional)
- Specific architecture preferences
- Cloud provider preference
- Security/compliance requirements
- Performance targets
- Budget constraints

## Output Format

```json
{
  "summary": "markdown string (1000-1500 words)",
  "system_diagram": "mermaid graph string",
  "component_diagram": "mermaid graph string",
  "flow_diagrams": [
    "mermaid sequence string (auth flow)",
    "mermaid sequence string (main feature flow)",
    "mermaid sequence string (error handling flow)"
  ],
  "database_schema": "mermaid ER string",
  "deployment_architecture": "mermaid graph string",
  "iac_plan": "markdown string (500-800 words + code)",
  "metadata": {
    "generated_at": "ISO timestamp",
    "model": "claude-sonnet-4",
    "tokens_used": 12500,
    "generation_time_ms": 25000,
    "discussion_id": "uuid",
    "project_id": "uuid"
  }
}
```

## Quality Standards

### Completeness
- All 7 artifacts must be generated
- No missing sections or placeholder text
- Comprehensive coverage of all discussed requirements
- Addresses all features mentioned in consensus

### Accuracy
- All Mermaid syntax must be valid and renderable
- Technically sound architectural decisions
- Realistic resource estimates and configurations
- Industry best practices followed
- Aligns with discussion consensus

### Clarity
- Clear, descriptive component names (no cryptic abbreviations)
- Logical organization and flow
- Easy to understand diagrams
- Well-documented rationale for decisions

### Consistency
- Naming conventions maintained across all artifacts
- Diagram styles unified
- Technology stack coherent
- Architecture patterns aligned

### Professionalism
- Enterprise-grade quality
- Production-ready design
- Comprehensive documentation
- Suitable for stakeholder presentation and development teams

## Integration Instructions

### Trigger Point
1. LangGraph discussion reaches consensus (`consensus_reached: true`)
2. User confirms discussion completion
3. API call to extract architecture artifacts

### API Endpoint
```
POST /api/langgraph/discussion/extract/architecture/{discussion_id}
```

### Response
- Returns all 7 artifacts in JSON format
- Stores artifacts in VISHKAR project storage
- Makes artifacts available in frontend UI
- Enables export to Confluence, PDF, and JIRA attachment

### Frontend Display
- Tabbed interface with 7 tabs
- Mermaid diagram rendering in browser
- Download buttons (JSON, PDF)
- Export buttons (Confluence, JIRA)
- Share link generation

## Related Contexts

- **c-core-sdlc.mdc:** Enterprise SDLC practices
- **c-infrastructure-as-code.mdc:** IaC best practices
- **c-pr-review.mdc:** Code review standards (for generated code)
- **c-cloud-data-engineering.mdc:** Cloud architecture patterns
- **c-confluence-docs.mdc:** Documentation export standards

## Example Usage

### Scenario 1: Task Management App
**Input:** Discussion consensus for a task management app with React frontend, Node.js backend, PostgreSQL database, targeting 10,000 users with 100 concurrent connections.

**Output:** Complete architecture with:
- Three-tier architecture summary
- AWS ECS Fargate + RDS + ElastiCache deployment
- Component breakdown with React pages, Express services, database repositories
- Authentication and task creation flow diagrams
- Database schema with 7 tables (users, projects, tasks, comments, attachments, etc.)
- AWS deployment architecture with Multi-AZ RDS, auto-scaling ECS
- Terraform IaC plan with modules for networking, compute, database

### Scenario 2: E-commerce Platform
**Input:** E-commerce platform requiring high availability, payment processing, inventory management, 100,000 users, PCI compliance.

**Output:** Architecture emphasizing:
- Microservices pattern for scalability
- Payment service isolation for PCI compliance
- Event-driven architecture for inventory updates
- Multi-region deployment for high availability
- Database sharding strategy for scale
- Comprehensive security architecture (WAF, encryption, tokenization)

## Maintenance

### Updates
- Review vishkar-architect.md monthly for improvements
- Incorporate new cloud services and patterns
- Add new diagram types as needed
- Refine based on user feedback and generated architecture quality

### Version
- **Current:** 1.0.0
- **Created:** October 12, 2025
- **Last Updated:** October 12, 2025

## Notes

- This context loads the comprehensive VISHKAR Architect persona file
- All templates and examples are embedded in the persona file (single source of truth)
- No separate template files required
- Enhanced-context MCP loads this context when "architecture" query type is detected
- Can be combined with c-core-sdlc and c-infrastructure-as-code for enriched context
